package frc.robot.subsystems;

import com.revrobotics.CANEncoder;
import com.revrobotics.CANSparkMax;
import com.revrobotics.CANSparkMaxLowLevel.MotorType;
import edu.wpi.first.math.controller.PIDController;
import edu.wpi.first.math.geometry.Rotation2d;
import edu.wpi.first.wpilibj2.command.SubsystemBase;
import frc.robot.Constants;

public class Joint1Subsystem extends SubsystemBase {
    private final CANSparkMax motor;
    private final CANEncoder encoder;
    private final PIDController pidController;
    private static final double GEAR_RATIO = 16.0; // 16:1 gearbox


    public Joint1Subsystem() {
        motor = new CANSparkMax(Constants.OperatorConstants.Joint1MotorID, MotorType.kBrushless);
        encoder = motor.getEncoder();
        pidController = new PIDController(Constants.PIDConstants.Joint1P, Constants.PIDConstants.Joint1I, Constants.PIDConstants.Joint1D);
    }

    public void setSetpoint(Rotation2d setpoint) {
        double angle = setpoint.getDegrees();
        double output = pidController.calculate(getCurrentAngle(), angle);
        motor.set(output);
    }

    private double getCurrentAngle() {
        // Read the current angle from the encoder
        double encoderPosition = encoder.getPosition();
        // Convert encoder position to degrees (assuming 1 rotation = 360 degrees)
        double currentAngle = (encoderPosition / GEAR_RATIO) * 360.0;
        return currentAngle;
    }
}